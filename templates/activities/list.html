{% extends 'base.html' %}
{% load static %}

{% block title %}Atividades - UFC Sobral{% endblock %}

{% block extra_js %}
<script>
// Alternar visualização
document.addEventListener('DOMContentLoaded', function() {
    const gridViewBtn = document.getElementById('gridViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const container = document.getElementById('activitiesContainer');
    
    if (!gridViewBtn || !listViewBtn || !container) return;
    
    // Carregar preferência salva
    const savedView = localStorage.getItem('activitiesView') || 'grid';
    setView(savedView);
    
    gridViewBtn.addEventListener('click', () => setView('grid'));
    listViewBtn.addEventListener('click', () => setView('list'));
    
    function setView(view) {
        if (view === 'grid') {
            container.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fadeIn';
            gridViewBtn.className = 'p-2.5 text-blue-600 bg-blue-100 dark:bg-blue-900 dark:text-blue-300 rounded-lg transition-colors';
            listViewBtn.className = 'p-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors';
        } else {
            container.className = 'flex flex-col gap-4 animate-fadeIn';
            listViewBtn.className = 'p-2.5 text-blue-600 bg-blue-100 dark:bg-blue-900 dark:text-blue-300 rounded-lg transition-colors';
            gridViewBtn.className = 'p-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors';
        }
        localStorage.setItem('activitiesView', view);
    }
});
</script>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Card Principal -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden">
            <!-- Header do Card -->
            <div class="px-8 pt-8 pb-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-2">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Atividades</h1>
                        <p class="text-gray-600 dark:text-gray-400">Gerencie todas as atividades da UFC Sobral</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <a href="{% url 'activity_create' %}" 
                           class="px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2 shadow-lg hover:shadow-xl">
                            <i class="fas fa-plus"></i>
                            Nova Atividade
                        </a>
                        <button id="gridViewBtn" class="p-2.5 text-blue-600 bg-blue-100 dark:bg-blue-900 dark:text-blue-300 rounded-lg transition-colors">
                            <i class="fas fa-th"></i>
                        </button>
                        <button id="listViewBtn" class="p-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Filtros e Busca -->
            <div class="px-8 py-6">
                <form method="GET" 
                      hx-get="{% url 'activity_search_htmx' %}"
                      hx-trigger="input changed delay:100ms from:#search, change from:#type, change from:#status, change from:#start_date, change from:#end_date"
                      hx-target="#search-results"
                      hx-swap="innerHTML"
                      class="space-y-4 md:space-y-0 md:flex md:items-end md:gap-4">
                    <!-- Busca -->
                    <div class="flex-1">
                        <label for="search" class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5">
                            Buscar
                        </label>
                        <div class="relative">
                            <input type="text" 
                                   name="search" 
                                   id="search"
                                   value="{{ request.GET.search }}"
                                   placeholder="Buscar atividades..."
                                   class="w-full px-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 pr-10">
                            <i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                        </div>
                    </div>
                    
                    <!-- Filtro por Tipo -->
                    <div class="w-full md:w-48">
                        <label for="type" class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5">
                            Tipo
                        </label>
                        <select name="type" id="type" class="w-full px-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 appearance-none">
                            <option value="">Todos os tipos</option>
                            {% for value, label in activity_types %}
                                <option value="{{ value }}" {% if request.GET.type == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Filtro por Status -->
                    <div class="w-full md:w-48">
                        <label for="status" class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5">
                            Status
                        </label>
                        <select name="status" id="status" class="w-full px-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 appearance-none">
                            <option value="">Todos os status</option>
                            {% for value, label in status_choices %}
                                <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Data Início -->
                    <div class="w-full md:w-40">
                        <label for="start_date" class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5">
                            Data Início
                        </label>
                        <input type="date" 
                               name="start_date" 
                               id="start_date"
                               value="{{ request.GET.start_date }}"
                               class="w-full px-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    
                    <!-- Data Fim -->
                    <div class="w-full md:w-40">
                        <label for="end_date" class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5">
                            Data Fim
                        </label>
                        <input type="date" 
                               name="end_date" 
                               id="end_date"
                               value="{{ request.GET.end_date }}"
                               class="w-full px-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    
                </form>
            </div>
            
            <!-- Resultados -->
            <div id="search-results">
                {% include 'activities/partials/activity_results.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
